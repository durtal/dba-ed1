<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>Chapter 7: Exercises</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">
    body {
        padding-top: 20px;
        padding-bottom: 20px;
    }
    @media (max-width: 979px) {
        body {
            padding-top: 0;
        }
    }

    @media (min-width: 980px) {
        .section h2 {
            padding-top: 52px;
            margin-top: -52px;
        }
        .section h3 {
            padding-top: 52px;
            margin-top: -52px;
        }
    }

    p {
        font-size: 13px;
    }

    #disqus_thread {
        margin-top: 45px;
    }
</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; }
code > span.ch { color: #008080; }
code > span.st { color: #008080; }
code > span.co { color: #008000; }
code > span.ot { color: #ff4000; }
code > span.al { color: #ff0000; }
code > span.er { font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<h2>Doing Bayesian Data Analysis</h2>
<h5>Working through the book <a href="http://www.amazon.co.uk/Doing-Bayesian-Data-Analysis-Tutorial/dp/0123814855/ref=sr_1_2?s=books&ie=UTF8&qid=1432494439&sr=1-2&keywords=doing+bayesian+data+analysis">Doing Bayesian Data Analysis</a> (ed.1) by John Kruschke, inc. examples and exercises.</h5>

<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button class="navbar-toggle collapsed" data-toggle="collapse" data-target="#dba-nav">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://durtal.github.io" class="navbar-brand">durtal.github.io</a>
        </div>
        <div class="collapse navbar-collapse" id="dba-nav">
            <ul class="nav navbar-nav">
                <li>
                    <a href="index.html">DBDA Home</a>
                </li>
                <li class="dropdown">
                    <a href="" class="dropdown-toggle" data-toggle="dropdown">
                        Exercises <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="chapter2-exercises.html">Chapter 2</a>
                        </li>
                        <li>
                            <a href="chapter3-exercises.html">Chapter 3</a>
                        </li>
                        <li>
                            <a href="chapter4-exercises.html">Chapter 4</a>
                        </li>
                        <li>
                            <a href="chapter5-exercises.html">Chapter 5</a>
                        </li>
                        <li>
                            <a href="chapter6-exercises.html">Chapter 6</a>
                        </li>
                        <li>
                            <a href="chapter7-exercises.html">Chapter 7</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="" class="dropdown-toggle" data-toggle="dropdown">
                        Other <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="how-not-to-be-wrong-roulette.html">How Not To Be Wrong</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div id="header">
<h1 class="title">Chapter 7: Exercises</h1>
</div>


<div id="inferring-a-binomial-proportion-via-the-metropolis-algorithm" class="section level2">
<h2>Inferring a Binomial Proportion via the Metropolis Algorithm</h2>
<div id="section" class="section level3">
<h3>7.1</h3>
<p>To see what happens in the Metropolis algorithm with different proposal distributions, and to get a sense how the proposal distribution must be <em>tuned</em> to the target distribution. Use the home-grown Metropolis algorithm in the R script <a href="https://github.com/durtal/dba-ed1/blob/master/code-data/BernMetropolisTemplate.R">BernMetropolisTemplate.R</a> for this exercise.</p>
<blockquote>
<p>The proposal distribution generates candidate jumps that are normally distributed with mean zero. Set the standard deviation of the proposal distribution to 0.1 and plot.</p>
</blockquote>
<blockquote>
<p>Set the standard deviation of the proposal distribution to 0.001 and plot.</p>
</blockquote>
<blockquote>
<p>Set the standard deviation of the proposal distribution to 100.0 and plot.</p>
</blockquote>
<p>Example code for the plot below left:</p>
<pre class="sourceCode r"><code class="sourceCode r">myData &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)    <span class="co"># data</span>
trajLength &lt;-<span class="st"> </span><span class="dv">10000</span>                         <span class="co"># number of jumps to try</span>
trajectory &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, trajLength)            <span class="co"># vector to store results</span>
trajectory[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="fl">0.5</span>                        <span class="co"># start value</span>
burnIn &lt;-<span class="st"> </span><span class="kw">ceiling</span>(<span class="fl">0.1</span> *<span class="st"> </span>trajLength)         <span class="co"># burn in number</span>
nAccepted1 &lt;-<span class="st"> </span><span class="dv">0</span>                              <span class="co"># track no. of jumps accepted</span>
nRejected1 &lt;-<span class="st"> </span><span class="dv">0</span>                              <span class="co"># track no. of jumps rejected</span>
stdev1 &lt;-<span class="st"> </span><span class="fl">0.1</span>                                <span class="co"># standard deviation</span>
for(t in <span class="dv">1</span>:(trajLength)) {
    currentPosition &lt;-<span class="st"> </span>trajectory[t]
    <span class="co"># use proposal distribution to generate a proposed jump.</span>
    proposedJump &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> stdev1)
    <span class="co"># compute the probability of accepting the proposed jump.</span>
    probAccept &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="dv">1</span>,
                      <span class="kw">targetRelProb</span>(currentPosition +<span class="st"> </span>proposedJump, myData) /
<span class="st">                          </span><span class="kw">targetRelProb</span>(currentPosition, myData))
    <span class="co"># generate random uniform value from interval [0,1] to decide whether to accept jump</span>
    if(<span class="kw">runif</span>(<span class="dv">1</span>) &lt;<span class="st"> </span>probAccept) {
        <span class="co"># accept proposed jump</span>
        trajectory[t<span class="dv">+1</span>] &lt;-<span class="st"> </span>currentPosition +<span class="st"> </span>proposedJump
        if(t &gt;<span class="st"> </span>burnIn) {
            <span class="co"># increment accepted counter</span>
            nAccepted1 &lt;-<span class="st"> </span>nAccepted1 +<span class="st"> </span><span class="dv">1</span>
        }
    } else {
        <span class="co"># reject proposed jump</span>
        trajectory[t<span class="dv">+1</span>] &lt;-<span class="st"> </span>currentPosition
        if(t &gt;<span class="st"> </span>burnIn) {
            <span class="co"># increment rejected counter</span>
            nRejected1 &lt;-<span class="st"> </span>nRejected1 +<span class="st"> </span><span class="dv">1</span>
        }
    }
}
<span class="co"># remove burnIn period</span>
acceptedTraj &lt;-<span class="st"> </span>trajectory[(burnIn<span class="dv">+1</span>):<span class="kw">length</span>(trajectory)]</code></pre>
<div class="row">
<div class="col-sm-4">
<p><img src="chapter7-exercises_files/figure-html/unnamed-chunk-4-1.png" title="" alt="" width="672" /></p>
</div>
<div class="col-sm-4">
<p><img src="chapter7-exercises_files/figure-html/unnamed-chunk-5-1.png" title="" alt="" width="672" /></p>
</div>
<div class="col-sm-4">
<p><img src="chapter7-exercises_files/figure-html/unnamed-chunk-6-1.png" title="" alt="" width="672" /></p>
</div>
</div>
<blockquote>
<p>Which proposal distribution gave the most accurate representation of the posterior? Which proposal distribution had the most rejected proposals? Which proposal distribution had the most rejected proposals?</p>
</blockquote>
<p>The proposal with <span class="math">\(SD = 0.1\)</span> gave the most accurate representation of the posterior. The number of rejected proposals for each were, <strong>2460</strong> when <span class="math">\(SD = 0.1\)</span>, <strong>93</strong> when <span class="math">\(SD = 0.001\)</span> and <strong>8991</strong> when <span class="math">\(SD = 100\)</span>.</p>
</div>
<div id="section-1" class="section level3">
<h3>7.2</h3>
<p>To understand the influence of the starting point of the random walk, and why the walk doesnâ€™t necessarily go back to that region. Edit the homegrown Metropolis algorithm in <a href="https://github.com/durtal/dba-ed1/blob/master/code-data/BernMetropolisTemplate.R">BernMetropolisTemplate.R</a> for this exercise. Set <code>trajLength = 100</code> and set <code>burnIn = ceiling(0.001 * trajLength)</code>, finally set <code>trajectory[1] = 0.001</code>. Now run the script and save the resulting histogram.</p>
<div class="row">
<div class="col-sm-6">
<p><img src="chapter7-exercises_files/figure-html/unnamed-chunk-7-1.png" title="" alt="" width="672" /></p>
</div>
<div class="col-sm-6">
<p><img src="chapter7-exercises_files/figure-html/unnamed-chunk-8-1.png" title="" alt="" width="672" /></p>
</div>
</div>
<blockquote>
<p>How many jumps are proposed? How many steps are excluded as part of the burn-in portion? At what value does the random walk start?</p>
</blockquote>
<p>The histogram above plots the result of the random walk. There are 100 steps proposed (<code>trajLength = 100</code>), burn in portion was 1% (<code>burnIn = 0.01</code>) of 100, so just 1 step, and the walk started at 0.001 (<code>trajectory[1] = 0.001</code>).</p>
<blockquote>
<p>Why does the histogram above have so many points below 0.5? That is, why does the chain stay below 0.5 as long as it does?</p>
</blockquote>
<p>The initial value is 0.001, so the chain starts at the far left. The proposal distribution has a small SD of 0.1, so jumps are fairly small, meaning progress to values above 0.5 is slow.</p>
<blockquote>
<p>Why does the histogram have so few points below 0.5? That is why does the chain not go back below 0.5?</p>
</blockquote>
<p>The chain eventually stays to the right of 0.5 because the posterior probability values to the left of 0.5 is small. Plotting the trajectory instead, above right, of the histogram shows the steps of the random walk.</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
